<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="MarWinsWorld">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://marwinsworld.github.io//images/banner.jpg">
    <meta property="twitter:image" content="https://marwinsworld.github.io//images/banner.jpg" />
    

    
    <meta name="title" content="Install Ansible on the ManagementPi" />
    <meta property="og:title" content="Install Ansible on the ManagementPi" />
    <meta property="twitter:title" content="Install Ansible on the ManagementPi" />
    

    
    <meta name="description" content="">
    <meta property="og:description" content="" />
    <meta property="twitter:description" content="" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="Markus, Winkler, Raspberry, Pi, Docker, Kubernetes, Container, Smart Home, Automation, API, Microservice">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>Install Ansible on the ManagementPi-Markus Winkler Blog</title>

    <link rel="canonical" href="/post/raspberry-ansible/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>

    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet" type="text/css">

    
    

    
    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    

</head>



<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">MarWinsWorld</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                        
                        <li>
                            <a href="/categories/home-lab">home-lab</a>
                        </li>
                        
                        <li>
                            <a href="/categories/learning">learning</a>
                        </li>
                        
                        <li>
                            <a href="/categories/mangementpi">mangementpi</a>
                        </li>
                        
                    
                    
		    
                        <li><a href="/top/about/">ABOUT</a></li>
                    

                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/images/banner.jpg')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/mangementpi" title="MangementPi">
                            MangementPi
                        </a>
                        
                        <a class="tag" href="/tags/ubuntu" title="Ubuntu">
                            Ubuntu
                        </a>
                        
                        <a class="tag" href="/tags/ansible" title="Ansible">
                            Ansible
                        </a>
                        
                        <a class="tag" href="/tags/raspberrypi" title="RaspberryPi">
                            RaspberryPi
                        </a>
                        
                    </div>
                    <h1>Install Ansible on the ManagementPi</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by 
                        
                                MarWinsWorld
                         
                        on 
                        Sunday, March 28, 2021
                        
                        
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                post-container">

                
                <header>
                    <h2>TOC</h2>
                </header>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#install-ansible-on-the-managementpi">Install Ansible on the ManagementPi</a></li>
    <li><a href="#create-the-ansible-configuration">Create the Ansible Configuration</a></li>
    <li><a href="#create-the-ssh-keypair-for-ansible">Create the ssh Keypair for Ansible</a></li>
    <li><a href="#ansible-vault">Ansible Vault</a></li>
    <li><a href="#optional-helper-tools">(Optional) Helper Tools</a>
      <ul>
        <li><a href="#ansible-lint">Ansible-Lint</a></li>
        <li><a href="#jq">jq</a></li>
      </ul>
    </li>
  </ul>
</nav>
                
                <p>After we&rsquo;ve set up the OS, let&rsquo;s go ahead and install Ansible.</p>
<h2 id="install-ansible-on-the-managementpi">Install Ansible on the ManagementPi</h2>
<p>In real life, you should create an ansible user on your Ansible server to run all the playbooks. For simplicity we skip that on our small management server and just use the already existing ubuntu user.
Now we prepare for Ansible by adding the <code>universe</code>-Repository and installing <code>python3-pip</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo apt-get update
sudo add-apt-repository universe
sudo apt install -y python3-pip
</code></pre></div><p>When we install Ansible it is shipped with many python modules and dependencies. It is good to install Ansible in userspace, so it won&rsquo;t affect system-wide.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">pip3 install ansible --user
echo <span style="color:#e6db74">&#39;export PATH=$PATH:$HOME/.local/bin&#39;</span> &gt;&gt; ~/.bashrc
source .bashrc
ansible --version
</code></pre></div><p>The last command should return something like the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ansible 2.10.7
  config file <span style="color:#f92672">=</span> /home/ubuntu/.ansible.cfg
  configured module search path <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#e6db74">&#39;/home/ubuntu/.ansible/plugins/modules&#39;</span>, <span style="color:#e6db74">&#39;/usr/share/ansible/plugins/modules&#39;</span><span style="color:#f92672">]</span>
  ansible python module location <span style="color:#f92672">=</span> /home/ubuntu/.local/lib/python3.8/site-packages/ansible
  executable location <span style="color:#f92672">=</span> /home/ubuntu/.local/bin/ansible
  python version <span style="color:#f92672">=</span> 3.8.6 <span style="color:#f92672">(</span>default, Jan <span style="color:#ae81ff">27</span> 2021, 15:42:20<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>GCC 10.2.0<span style="color:#f92672">]</span>
</code></pre></div><h2 id="create-the-ansible-configuration">Create the Ansible Configuration</h2>
<p>Next, you need to create an <code>.ansible.cfg</code> in your home directory which will overwrite the one in <code>/etc/ansible/ansible.cfg</code>. We get an example config directly from the Ansible GitHub repo.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">wget https://raw.githubusercontent.com/ansible/ansible/devel/examples/ansible.cfg -O .ansible.cfg
</code></pre></div><p>Set the following variables in <code>/home/ubuntu/.ansible.cfg</code> within the <code>[defaults]</code>-chapter at the beginning of the file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">vi ~/.ansible.cfg
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ae81ff">inventory       = /home/ubuntu/manager/inventory/hosts.yaml</span>
<span style="color:#ae81ff">interpreter_python = auto</span>
<span style="color:#ae81ff">log_path = /var/log/ansible.log</span>
<span style="color:#ae81ff">display_skipped_hosts = False</span>
</code></pre></div><h2 id="create-the-ssh-keypair-for-ansible">Create the ssh Keypair for Ansible</h2>
<p>Ansible with authentiticate to Linux hosts in your environment using ssh keys. For this we need to create the keys and then add them to the authorized keys on the target machines.</p>
<p>Star with creating a <code>.ssh</code> directory if it is not already existing</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mkdir -p ~/.ssh
chmod <span style="color:#ae81ff">700</span> ~/.ssh
</code></pre></div><p>Then, generate ssh-keys without setting a passphrase</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ssh-keygen
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">Generating public/private rsa key pair.
Enter file in which to save the key <span style="color:#f92672">(</span>/home/ubuntu/.ssh/id_rsa<span style="color:#f92672">)</span>:
Created directory <span style="color:#e6db74">&#39;/home/ubuntu/.ssh&#39;</span>.
Enter passphrase <span style="color:#f92672">(</span>empty <span style="color:#66d9ef">for</span> no passphrase<span style="color:#f92672">)</span>: &lt;DON<span style="color:#e6db74">&#39;T SET A PASSPHRASE HERE&gt;
</span><span style="color:#e6db74">Enter same passphrase again:
</span><span style="color:#e6db74">Your identification has been saved in /home/ubuntu/.ssh/id_rsa.
</span><span style="color:#e6db74">Your public key has been saved in /home/ubuntu/.ssh/id_rsa.pub.
</span><span style="color:#e6db74">The key fingerprint is:
</span><span style="color:#e6db74">SHA256:1gzgC5QR+tSX6YQsQvBiZKEi4+Ez04b7k5sMwGen7Yk ubuntu@manager
</span><span style="color:#e6db74">The key&#39;</span>s randomart image is:
+---<span style="color:#f92672">[</span>RSA 2048<span style="color:#f92672">]</span>----+
|.<span style="color:#f92672">=</span>o ++.          |
|+o o.+ o o       |
|*o+ + <span style="color:#f92672">=</span> *        |
|Bo++ o <span style="color:#f92672">=</span> +       |
|.O <span style="color:#f92672">=</span>... S o      |
|. O +  .         |
| o ...           |
|  +o+ .          |
|   Eoo           |
+----<span style="color:#f92672">[</span>SHA256<span style="color:#f92672">]</span>-----+
</code></pre></div><p>There will be two new files within the <code>/home/ubuntu/.ssh</code>-directory, the private and the public part of the keypair just generated.</p>
<h2 id="ansible-vault">Ansible Vault</h2>
<p>For all credentials, we will use the <code>ansible-vault</code>. Create a file called <code>.vault-pass.txt</code> in the home directory of the <code>ubuntu</code>-user with a secret password.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">echo <span style="color:#e6db74">&#39;&lt;YOUR VERY STRONG PASSWORD&gt;&#39;</span> &gt; ~/.vault-pass.txt
chmod <span style="color:#ae81ff">600</span> ~/.vault-pass.txt
</code></pre></div><h2 id="optional-helper-tools">(Optional) Helper Tools</h2>
<h3 id="ansible-lint">Ansible-Lint</h3>
<p>The tool <code>ansible-lint</code> helps you to verify, that your Ansible playbooks conform to the specification.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">pip3 install -U <span style="color:#e6db74">&#34;ansible-lint[community,yamllint]&#34;</span>
</code></pre></div><h3 id="jq">jq</h3>
<p>The &ldquo;Swiss Army Knife&rdquo; for JSON is, simply put, <code>jq</code>. Install it with the following command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo apt-get install jq
</code></pre></div>

                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/raspberry-ubuntu-20.04/" data-toggle="tooltip" data-placement="top" title="Ubuntu Focal Fossa (20.04) on the ManagementPi">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/raspberry-docker/" data-toggle="tooltip" data-placement="top" title="Install Docker on the ManagementPi">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>

                
<div id="disqus-comment"></div>



            </div>
            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="/tags/ansible" title="ansible">
                            ansible
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/mangementpi" title="mangementpi">
                            mangementpi
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/raspberrypi" title="raspberrypi">
                            raspberrypi
                        </a>
                        
                        
                        
                        <a href="/tags/ubuntu" title="ubuntu">
                            ubuntu
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href='' rel="alternate" type="application/rss+xml" title="MarWinsWorld" >
                           <span class="fa-stack fa-lg">
                               <i class="fas fa-circle fa-stack-2x"></i>
                               <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:winkler.info@icloud.com">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    

                    
                    
                    

                    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/mawinkler">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/markus-winkler-785baa34/">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    <li>
                        <a target="_blank" href="https://stackoverflow.com/users/11304166/maralex">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
            
                    
                    <li>
                        <a target="_blank" href="https://www.reddit.com/user/heldchen">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-reddit fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
            
                    
                    
            
            
            
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; MarWinsWorld 2021
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






</body>
</html>
